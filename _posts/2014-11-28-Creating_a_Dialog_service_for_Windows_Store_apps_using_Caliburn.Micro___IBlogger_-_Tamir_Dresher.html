---
layout: msblogpost
title: "Creating a Dialog service for Windows Store apps using Caliburn.Micro "
date: 2014-11-28
msblogurl: "http://blogs.microsoft.co.il/iblogger/2014/11/28/creating-dialog-service-windows-store-apps-using-caliburn-micro/"
---
<DIV class="contx entry-content clearfix"><P>When you want to display a dislog screen in windows store apps, you can use <A href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.flyout.aspx">Flyout</A>, <A href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.popups.messagedialog.aspx">MessageDialog</A> or <A href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.primitives.popup">Popup</A></P>
<P>the first two should be used for the simple cases – message prompts, question, basic user interaction.</P>
<P>But if you need to display a richer dialog then Popup is the right fit.</P>
<P>The MVVM way to open those dialogs is by using some kind of DialogService that will be called from you ViewModels.</P>
<P>in all the sample i’ve seen on using Popup it always has a strong coupling to the View itself, meaning the Popup was embedded inside the view layout and was triggered to appear by changing the <A href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.primitives.popup.isopen.aspx">IsOpen</A> property to true. </P>
<P>I wanted to create a service that creates the popup for me, no matter from where i call it. for me, the right approach is to open the popup above the application Frame.</P>
<P>Since im a <A href="http://caliburnmicro.com/">Caliburn.Micro</A> fan and since Caliburn is the framework with i did it in Caliburn style.</P>
<DIV id=scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:0e32172f-858e-4834-a0e7-54bcc910e631 class=wlWriterEditableSmartContent style="FLOAT: none; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px"><PRE><DIV><DIV id=highlighter_929138 class="syntaxhighlighter  csharp"><DIV class=toolbar><SPAN><A class="toolbar_item command_help help" href="https://tamirdresher.github.io/2014/11/28/creating-dialog-service-windows-store-apps-using-caliburn-micro/#">?</A></SPAN></DIV><TABLE cellSpacing=0 cellPadding=0 border=0><TBODY><TR><TD class=gutter><DIV class="line number1 index0 alt2">1</DIV><DIV class="line number2 index1 alt1">2</DIV><DIV class="line number3 index2 alt2">3</DIV><DIV class="line number4 index3 alt1">4</DIV><DIV class="line number5 index4 alt2">5</DIV><DIV class="line number6 index5 alt1">6</DIV><DIV class="line number7 index6 alt2">7</DIV><DIV class="line number8 index7 alt1">8</DIV><DIV class="line number9 index8 alt2">9</DIV><DIV class="line number10 index9 alt1">10</DIV><DIV class="line number11 index10 alt2">11</DIV><DIV class="line number12 index11 alt1">12</DIV><DIV class="line number13 index12 alt2">13</DIV><DIV class="line number14 index13 alt1">14</DIV><DIV class="line number15 index14 alt2">15</DIV><DIV class="line number16 index15 alt1">16</DIV><DIV class="line number17 index16 alt2">17</DIV><DIV class="line number18 index17 alt1">18</DIV><DIV class="line number19 index18 alt2">19</DIV><DIV class="line number20 index19 alt1">20</DIV><DIV class="line number21 index20 alt2">21</DIV><DIV class="line number22 index21 alt1">22</DIV><DIV class="line number23 index22 alt2">23</DIV><DIV class="line number24 index23 alt1">24</DIV><DIV class="line number25 index24 alt2">25</DIV><DIV class="line number26 index25 alt1">26</DIV><DIV class="line number27 index26 alt2">27</DIV><DIV class="line number28 index27 alt1">28</DIV><DIV class="line number29 index28 alt2">29</DIV><DIV class="line number30 index29 alt1">30</DIV><DIV class="line number31 index30 alt2">31</DIV><DIV class="line number32 index31 alt1">32</DIV><DIV class="line number33 index32 alt2">33</DIV><DIV class="line number34 index33 alt1">34</DIV><DIV class="line number35 index34 alt2">35</DIV><DIV class="line number36 index35 alt1">36</DIV><DIV class="line number37 index36 alt2">37</DIV><DIV class="line number38 index37 alt1">38</DIV><DIV class="line number39 index38 alt2">39</DIV><DIV class="line number40 index39 alt1">40</DIV><DIV class="line number41 index40 alt2">41</DIV><DIV class="line number42 index41 alt1">42</DIV><DIV class="line number43 index42 alt2">43</DIV><DIV class="line number44 index43 alt1">44</DIV><DIV class="line number45 index44 alt2">45</DIV><DIV class="line number46 index45 alt1">46</DIV><DIV class="line number47 index46 alt2">47</DIV><DIV class="line number48 index47 alt1">48</DIV><DIV class="line number49 index48 alt2">49</DIV><DIV class="line number50 index49 alt1">50</DIV><DIV class="line number51 index50 alt2">51</DIV><DIV class="line number52 index51 alt1">52</DIV><DIV class="line number53 index52 alt2">53</DIV><DIV class="line number54 index53 alt1">54</DIV><DIV class="line number55 index54 alt2">55</DIV><DIV class="line number56 index55 alt1">56</DIV><DIV class="line number57 index56 alt2">57</DIV><DIV class="line number58 index57 alt1">58</DIV><DIV class="line number59 index58 alt2">59</DIV><DIV class="line number60 index59 alt1">60</DIV><DIV class="line number61 index60 alt2">61</DIV><DIV class="line number62 index61 alt1">62</DIV><DIV class="line number63 index62 alt2">63</DIV><DIV class="line number64 index63 alt1">64</DIV><DIV class="line number65 index64 alt2">65</DIV><DIV class="line number66 index65 alt1">66</DIV><DIV class="line number67 index66 alt2">67</DIV><DIV class="line number68 index67 alt1">68</DIV><DIV class="line number69 index68 alt2">69</DIV><DIV class="line number70 index69 alt1">70</DIV><DIV class="line number71 index70 alt2">71</DIV><DIV class="line number72 index71 alt1">72</DIV><DIV class="line number73 index72 alt2">73</DIV><DIV class="line number74 index73 alt1">74</DIV><DIV class="line number75 index74 alt2">75</DIV><DIV class="line number76 index75 alt1">76</DIV><DIV class="line number77 index76 alt2">77</DIV><DIV class="line number78 index77 alt1">78</DIV><DIV class="line number79 index78 alt2">79</DIV><DIV class="line number80 index79 alt1">80</DIV><DIV class="line number81 index80 alt2">81</DIV><DIV class="line number82 index81 alt1">82</DIV><DIV class="line number83 index82 alt2">83</DIV><DIV class="line number84 index83 alt1">84</DIV><DIV class="line number85 index84 alt2">85</DIV><DIV class="line number86 index85 alt1">86</DIV><DIV class="line number87 index86 alt2">87</DIV><DIV class="line number88 index87 alt1">88</DIV><DIV class="line number89 index88 alt2">89</DIV><DIV class="line number90 index89 alt1">90</DIV><DIV class="line number91 index90 alt2">91</DIV><DIV class="line number92 index91 alt1">92</DIV><DIV class="line number93 index92 alt2">93</DIV><DIV class="line number94 index93 alt1">94</DIV><DIV class="line number95 index94 alt2">95</DIV><DIV class="line number96 index95 alt1">96</DIV><DIV class="line number97 index96 alt2">97</DIV><DIV class="line number98 index97 alt1">98</DIV><DIV class="line number99 index98 alt2">99</DIV><DIV class="line number100 index99 alt1">100</DIV><DIV class="line number101 index100 alt2">101</DIV><DIV class="line number102 index101 alt1">102</DIV><DIV class="line number103 index102 alt2">103</DIV><DIV class="line number104 index103 alt1">104</DIV><DIV class="line number105 index104 alt2">105</DIV><DIV class="line number106 index105 alt1">106</DIV></TD><TD class=code><DIV class=container><DIV class="line number1 index0 alt2"><CODE class="csharp keyword">public</CODE> <CODE class="csharp keyword">class</CODE> <CODE class="csharp plain">DialogService : IDialogService</CODE></DIV><DIV class="line number2 index1 alt1"><CODE class="csharp plain">{</CODE></DIV><DIV class="line number3 index2 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;</CODE>&nbsp;</DIV><DIV class="line number4 index3 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">public</CODE> <CODE class="csharp keyword">virtual</CODE> <CODE class="csharp plain">Task ShowPopupAsync&lt;T&gt;(</CODE><CODE class="csharp keyword">object</CODE> <CODE class="csharp plain">context = </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">, IDictionary&lt;</CODE><CODE class="csharp keyword">string</CODE><CODE class="csharp plain">, </CODE><CODE class="csharp keyword">object</CODE><CODE class="csharp plain">&gt; settings = </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">) </CODE><CODE class="csharp keyword">where</CODE> <CODE class="csharp plain">T : IScreen</CODE></DIV><DIV class="line number5 index4 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number6 index5 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">rootModel = IoC.Get&lt;T&gt;();</CODE></DIV><DIV class="line number7 index6 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">return</CODE> <CODE class="csharp plain">ShowPopupAsync(rootModel, context, settings);</CODE></DIV><DIV class="line number8 index7 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number9 index8 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE>&nbsp;</DIV><DIV class="line number10 index9 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">public</CODE> <CODE class="csharp keyword">virtual</CODE> <CODE class="csharp plain">Task ShowPopupAsync(IScreen rootModel, </CODE><CODE class="csharp keyword">object</CODE> <CODE class="csharp plain">context = </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">, IDictionary&lt;</CODE><CODE class="csharp keyword">string</CODE><CODE class="csharp plain">, </CODE><CODE class="csharp keyword">object</CODE><CODE class="csharp plain">&gt; settings = </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">)</CODE></DIV><DIV class="line number11 index10 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number12 index11 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">taskCompletionSource = </CODE><CODE class="csharp keyword">new</CODE> <CODE class="csharp plain">TaskCompletionSource&lt;</CODE><CODE class="csharp keyword">bool</CODE><CODE class="csharp plain">&gt;();</CODE></DIV><DIV class="line number13 index12 alt2">&nbsp;</DIV><DIV class="line number14 index13 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">popup = CreatePopup(rootModel, settings);</CODE></DIV><DIV class="line number15 index14 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">view = ViewLocator.LocateForModel(rootModel, popup, context);</CODE></DIV><DIV class="line number16 index15 alt1">&nbsp;</DIV><DIV class="line number17 index16 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popup.Child = view;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </CODE></DIV><DIV class="line number18 index17 alt1">&nbsp;</DIV><DIV class="line number19 index18 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">ViewModelBinder.Bind(rootModel, popup, </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">);</CODE></DIV><DIV class="line number20 index19 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">Caliburn.Micro.Action.SetTargetWithoutContext(view, rootModel);</CODE></DIV><DIV class="line number21 index20 alt2">&nbsp;</DIV><DIV class="line number22 index21 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">SetPopupPosition(popup, view);</CODE></DIV><DIV class="line number23 index22 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE>&nbsp;</DIV><DIV class="line number24 index23 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">activatable = rootModel </CODE><CODE class="csharp keyword">as</CODE> <CODE class="csharp plain">IActivate;</CODE></DIV><DIV class="line number25 index24 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">if</CODE> <CODE class="csharp plain">(activatable != </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">)</CODE></DIV><DIV class="line number26 index25 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number27 index26 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">activatable.Activate();</CODE></DIV><DIV class="line number28 index27 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number29 index28 alt2">&nbsp;</DIV><DIV class="line number30 index29 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">deactivator = rootModel </CODE><CODE class="csharp keyword">as</CODE> <CODE class="csharp plain">IDeactivate;</CODE></DIV><DIV class="line number31 index30 alt2">&nbsp;</DIV><DIV class="line number32 index31 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popup.Closed += </CODE><CODE class="csharp keyword">delegate</CODE></DIV><DIV class="line number33 index32 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number34 index33 alt1">&nbsp;</DIV><DIV class="line number35 index34 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">try</CODE></DIV><DIV class="line number36 index35 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number37 index36 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">rootModel.CloseView = </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">;</CODE></DIV><DIV class="line number38 index37 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">if</CODE> <CODE class="csharp plain">(deactivator != </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">)</CODE></DIV><DIV class="line number39 index38 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number40 index39 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">deactivator.Deactivate(</CODE><CODE class="csharp keyword">true</CODE><CODE class="csharp plain">);</CODE></DIV><DIV class="line number41 index40 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number42 index41 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number43 index42 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">finally</CODE></DIV><DIV class="line number44 index43 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number45 index44 alt2">&nbsp;</DIV><DIV class="line number46 index45 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">taskCompletionSource.SetResult(</CODE><CODE class="csharp keyword">true</CODE><CODE class="csharp plain">);</CODE></DIV><DIV class="line number47 index46 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number48 index47 alt1">&nbsp;</DIV><DIV class="line number49 index48 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">};</CODE></DIV><DIV class="line number50 index49 alt1">&nbsp;</DIV><DIV class="line number51 index50 alt2">&nbsp;</DIV><DIV class="line number52 index51 alt1">&nbsp;</DIV><DIV class="line number53 index52 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popup.IsOpen = </CODE><CODE class="csharp keyword">true</CODE><CODE class="csharp plain">;</CODE></DIV><DIV class="line number54 index53 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">return</CODE> <CODE class="csharp plain">taskCompletionSource.Task;</CODE></DIV><DIV class="line number55 index54 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number56 index55 alt1">&nbsp;</DIV><DIV class="line number57 index56 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">private</CODE> <CODE class="csharp keyword">void</CODE> <CODE class="csharp plain">SetPopupPosition(Popup popup, UIElement popupContent)</CODE></DIV><DIV class="line number58 index57 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number59 index58 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">windowContnt = Window.Current.Content </CODE><CODE class="csharp keyword">as</CODE> <CODE class="csharp plain">UIElement;</CODE></DIV><DIV class="line number60 index59 alt1">&nbsp;</DIV><DIV class="line number61 index60 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popupContent.Measure(</CODE><CODE class="csharp keyword">new</CODE> <CODE class="csharp plain">Size(Window.Current.Bounds.Width, Window.Current.Bounds.Height));</CODE></DIV><DIV class="line number62 index61 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popupContent.Arrange(</CODE><CODE class="csharp keyword">new</CODE> <CODE class="csharp plain">Rect(0, 0, popupContent.DesiredSize.Width, popupContent.DesiredSize.Height));</CODE></DIV><DIV class="line number63 index62 alt2">&nbsp;</DIV><DIV class="line number64 index63 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">horizontalOffset = Math.Max(0, Window.Current.Bounds.Width / 2 - popupContent.DesiredSize.Width / 2);</CODE></DIV><DIV class="line number65 index64 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">verticalOffset = Math.Max(0, Window.Current.Bounds.Height / 2 - popupContent.DesiredSize.Height / 2);</CODE></DIV><DIV class="line number66 index65 alt1">&nbsp;</DIV><DIV class="line number67 index66 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popup.HorizontalOffset = horizontalOffset;</CODE></DIV><DIV class="line number68 index67 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popup.VerticalOffset = verticalOffset;</CODE></DIV><DIV class="line number69 index68 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number70 index69 alt1">&nbsp;</DIV><DIV class="line number71 index70 alt2">&nbsp;</DIV><DIV class="line number72 index71 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">protected</CODE> <CODE class="csharp keyword">virtual</CODE> <CODE class="csharp plain">Popup CreatePopup(</CODE><CODE class="csharp keyword">object</CODE> <CODE class="csharp plain">rootModel, IDictionary&lt;</CODE><CODE class="csharp keyword">string</CODE><CODE class="csharp plain">, </CODE><CODE class="csharp keyword">object</CODE><CODE class="csharp plain">&gt; settings)</CODE></DIV><DIV class="line number73 index72 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number74 index73 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">popup = </CODE><CODE class="csharp keyword">new</CODE> <CODE class="csharp plain">Popup();</CODE></DIV><DIV class="line number75 index74 alt2">&nbsp;</DIV><DIV class="line number76 index75 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">popup.IsLightDismissEnabled = </CODE><CODE class="csharp keyword">true</CODE><CODE class="csharp plain">;</CODE></DIV><DIV class="line number77 index76 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">ApplySettings(popup, settings);</CODE></DIV><DIV class="line number78 index77 alt1">&nbsp;</DIV><DIV class="line number79 index78 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">return</CODE> <CODE class="csharp plain">popup;</CODE></DIV><DIV class="line number80 index79 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number81 index80 alt2">&nbsp;</DIV><DIV class="line number82 index81 alt1">&nbsp;</DIV><DIV class="line number83 index82 alt2">&nbsp;</DIV><DIV class="line number84 index83 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">bool</CODE> <CODE class="csharp plain">ApplySettings(</CODE><CODE class="csharp keyword">object</CODE> <CODE class="csharp plain">target, IEnumerable&lt;KeyValuePair&lt;</CODE><CODE class="csharp keyword">string</CODE><CODE class="csharp plain">, </CODE><CODE class="csharp keyword">object</CODE><CODE class="csharp plain">&gt;&gt; settings)</CODE></DIV><DIV class="line number85 index84 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number86 index85 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">if</CODE> <CODE class="csharp plain">(settings != </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">)</CODE></DIV><DIV class="line number87 index86 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number88 index87 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">type = target.GetType();</CODE></DIV><DIV class="line number89 index88 alt2">&nbsp;</DIV><DIV class="line number90 index89 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">foreach</CODE> <CODE class="csharp plain">(</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">pair </CODE><CODE class="csharp keyword">in</CODE> <CODE class="csharp plain">settings)</CODE></DIV><DIV class="line number91 index90 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number92 index91 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">var</CODE> <CODE class="csharp plain">propertyInfo = type.GetPropertyCaseInsensitive(pair.Key);</CODE></DIV><DIV class="line number93 index92 alt2">&nbsp;</DIV><DIV class="line number94 index93 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">if</CODE> <CODE class="csharp plain">(propertyInfo != </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">)</CODE></DIV><DIV class="line number95 index94 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">{</CODE></DIV><DIV class="line number96 index95 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">propertyInfo.SetValue(target, pair.Value, </CODE><CODE class="csharp keyword">null</CODE><CODE class="csharp plain">);</CODE></DIV><DIV class="line number97 index96 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number98 index97 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number99 index98 alt2">&nbsp;</DIV><DIV class="line number100 index99 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">return</CODE> <CODE class="csharp keyword">true</CODE><CODE class="csharp plain">;</CODE></DIV><DIV class="line number101 index100 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number102 index101 alt1">&nbsp;</DIV><DIV class="line number103 index102 alt2"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp keyword">return</CODE> <CODE class="csharp keyword">false</CODE><CODE class="csharp plain">;</CODE></DIV><DIV class="line number104 index103 alt1"><CODE class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE class="csharp plain">}</CODE></DIV><DIV class="line number105 index104 alt2">&nbsp;</DIV><DIV class="line number106 index105 alt1"><CODE class="csharp plain">}</CODE></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
</PRE></DIV>
<P>One intersting thing about Popup is that it supports light dismiss, meaning i can close the popup by clicking outside its region, I decide to turn this option by default, you can always override it by passing false inside the settings dictionary.</P>
<P>Caliburn knows how to make the connection between the IScreen.TryClose() method and the Popup IsOpen property so i dont need to handle it by myself.</P><IFRAME style="BORDER-TOP-STYLE: none; OVERFLOW: hidden; BORDER-LEFT-STYLE: none; HEIGHT: 80px; BORDER-BOTTOM-STYLE: none; BORDER-RIGHT-STYLE: none" src="{{ site.url }}/assets/Creating a Dialog service for Windows Store apps using Caliburn.Micro _ IBlogger - Tamir Dresher_files/like.html" frameBorder=0 allowTransparency scrolling=no></IFRAME></DIV>
